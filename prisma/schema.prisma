generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id        String   @id @default(uuid())
  nome      String   @unique
  senha     String
  permissao String
  updatedAt DateTime @updatedAt
}

model Reserva {
  id                  String   @id @default(uuid())
  nome                String
  documento           String
  telefone            String
  email               String?
  dataEntrada         DateTime
  dataSaida           DateTime
  numeroPessoas       Int
  chale               String
  status              String
  valor               Float
  observacoes         String?
  desconto            Float    @default(0)
  valorPagoAntecipado Float    @default(0)
  criancas0a3         Int      @default(0)
  criancas4a9         Int      @default(0)
}

model Despesa {
  id        String   @id @default(uuid())
  nome      String
  valor     Float
  categoria String
  data      DateTime
  updatedAt DateTime @updatedAt
}

model CheckIn {
  id                    Int       @id @default(autoincrement())
  nome                  String
  status                String    @default("aberto")
  dataNascimento        String?
  sexo                  String?
  telefone              String?
  email                 String?
  nacionalidade         String?
  documento             String?
  endereco              String?
  bairro                String?
  numero                String?
  cidade                String?
  estado                String?
  cep                   String?
  acompanhantes         Json?
  entrada               DateTime
  saida                 DateTime
  chale                 String
  valor                 Float
  valorEntrada          String?
  adultos               String?
  criancas0a3           String?
  criancas4a9           String?
  descontoPersonalizado String?
  observacoes           String?
  updatedAt             DateTime   @updatedAt

  consumos   Consumo[]   @relation("CheckInToConsumo")
  checkOut   CheckOut?   @relation("CheckInCheckOut")
  faturamentos Faturamento[] @relation("CheckInFaturamento")
}

model Consumo {
  id           String    @id @default(uuid())
  cliente      String
  hospede      Boolean
  checkinId    Int?
  status       String
  criadoEm     DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  subcomandas  Json

  checkin      CheckIn?  @relation("CheckInToConsumo", fields: [checkinId], references: [id], onDelete: Cascade)
  faturamento  Faturamento? @relation(fields: [faturamentoId], references: [id])
  faturamentoId String?
}

model CheckOut {
  id            String   @id @default(uuid())
  checkinId     Int      @unique
  dataSaidaReal DateTime
  formaPagamento String
  total         Float

  checkin       CheckIn  @relation("CheckInCheckOut", fields: [checkinId], references: [id], onDelete: Cascade)
  faturamento   Faturamento? @relation(fields: [faturamentoId], references: [id])
  faturamentoId String?
}

model PrecosConfig {
  id              Int     @id @default(1)
  hospedagem      Json
  categoriasExtras Json
}

model Faturamento {
  id               String    @id @default(uuid())
  tipo             String    // "hospedagem" | "comanda_hospede" | "comanda_avulsa"
  referenciaId     String?   // checkOutId ou consumoId (para rastreabilidade)
  checkinId        Int?      // se for hospedagem/comanda h√≥spede
  nomeHospede      String?
  chale            String?
  dataEntrada      DateTime?
  dataSaida        DateTime?
  dataSaidaReal    DateTime?
  valorHospedagem  Float?    // hospedagem
  valorComanda     Float?    // comanda total
  total            Float?    // <<--- campo opcional (hospedagem+comanda)
  formaPagamento   String
  itensComanda     Json?     // [{produto, quantidade, valorUnit, valorTotal}, ...]
  criadoEm         DateTime  @default(now())
  
  checkin          CheckIn?   @relation("CheckInFaturamento", fields: [checkinId], references: [id])
  checkOut         CheckOut[] // Relacionar se quiser
  consumo          Consumo[]  // Relacionar se quiser
}
